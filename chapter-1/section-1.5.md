# Chapter 1: 리액트 개발을 위해 꼭 알아야 할 자바스크립트

## 1.5 이벤트 루프와 비동기 통신이 이해
- 자바스크립트는 싱글 스레드에 작동한다. 즉, 한번에 하나의 작업만 동기방식으로 처리할 수 있다
\* 동기(synchronous) : 직렬방식으로 작업 처리/ 응답을 받은 후 다른 작업 가능(그동안 다른 모든 작업 대기)
\* 비동기(asynchronous) : 병렬방식으로 작업 처리/ 요청 시작 후, 응답이 오건 말건 다음 작업이 이루어 진다.(한번에 여러 작업 실행)

### 1.5.1 싱글 스레드 자바스크립트
- 하나의 프로세스에 여러개의 스레드를 만들 수 있고, 스레드 끼리 메모리 공유 할 수 있어 여러 가지 작업을 동시 수행할 수 있다.(동시 다발 작업)
\* 프로세스(process) : 프로그램을 구동해 프로그램의 상태가 메로리상에서 실행되는 작업 단위를 의미. 즉, 하나의 프로그램 실행은 하나의 프로세스를 가지고 그 프로세스 내부에서 모든 작업이 처리되는 것을 의미
\* 스레드(thread) : 프로세스 보다 더 작은 실행 단위
\* 싱글 스레드 : 자바스크립트 코드의 실행이 하나의 스레드에서 순차적으로 이루어진다는 것을 의미(하나의 작업이 끝나기 전까지는 뒤이은 작업이 실행되지 않는다는 것을 의미)
\** Run-to-completion : 자바스크립트에서 하나의 코드가 실행하는데 오래 걸리면, 뒤이은 코드가 실행되지 않는다(사용자에게 웹페이지가 멈춘거 같은 느낌)

- 비동기 함수 선언 async(asynchronous)는 동시에 일어나지 않는 것을 의미
\+ 동기식과 다르게 요청한 즉시 결과가 주어지지 않을 수 있고, 응답이 언제 올지도 알 수 없다.
\+ 여러작업을 동시에 수행할 수 있다

### 1.5.2 이벤트 루프란?
- 자바스크립트 런타임 외부에서 자바스크립트의 비동기 실행을 돕기 위해 만들어진 장치
#### 1. 호출 스택과 이벤트 루프
- 자바스크립트에서 수행해야 할 코드나 함수를 순차적으로 담아두는 스택이다
- 호출 스택이 비어 있는지 여부를 확인하는 것(이벤트 루프)
\* '코드를 실행하는 것'과 '호출 스택이 비어있는지 확인하는 것' 모두가 단일 스레드에서 일어난다.
\+ 두 작업은 동시에 일어날 수 없으며 한스레드에서 순차적으로 일어난다.
- 이벤트 루프는 태스크 큐를 한 개 이상 가지고 있다
\* 태스크 큐란 : 실행해야 할 태스크의 집합
\+ 이름과 다르게 자료구조의 큐(queue)가 아니고 set 형태를 띠고 있다.
\+ 이유는 ? 선택된 큐 중에서 실행 가능한 가장 오래된 태스크를 가져와야 하기 때문이다
\+ 실행해야 할 태스크(태스크 큐의에서 의미) ? 비동기 함수의 콜백 함수나 이벤트 핸들러 등을 의미한다
- 이벤트 루프의 역할 : 호출 스택에 실행 중인 코드가 있는지, 그리고 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인하는 역할을 한다
- 정리
: 비동기 함수는 누가 수행하느냐? 'n초 뒤에 setTimeout을 요청하는 작업은 누가 처리할가? fetch를 기반으로 실행되는 네트워크 요청은 누가 보내고 응답을 받을 것인가?
: 모두 자바스크립트 코드가 동기식으로 실행되는 메인 스레드가 아닌, 태스크 큐가 할당되는 별도의 스레드에서 수행된다
(이 별도의 스레드에서 태스크 큐에 작업을 할당해 처리하는 것은 브라우저나 Node.js의 역할)
: 즉, 자바스크립트 코드 실행은 싱글 스레드에서 이루어지지만,
이러한 외부 Web API등은 모두 자바스크립트 외부에서 실행되고 콜백이 태스크 큐로 들어가는 것이다
: 이벤트 루프는 호출 스택이 비고, 콜백이 실행 가능한 때가 오면 이것을 꺼내서 수행하는 역할을 하는것

### 1.5.3 태스크 큐와 마이크로 태스크 큐
- 이벤트 루프는 하나의 마이크로 태스크 큐를 갖고 있다
- 대표적으로 Promise
- 마이크로 태스크큐는 우선권을 가진다
- setTimeout과 setInterval은 Promise보다 늦게 실행된다
+ 태스크 큐 : setTimeout, setInterval, setImmediate
+ 마이크로 태스크 큐 : process, nextTick, Promises, queueMicroTask, MutationObserver
\+ 실행 순서 : 1)마이크로 태스크 큐 2)뒤에 렌더링 (각 마이크로 태스크 큐 작업이 끝날 때 마다 한 번씩 런더링할 기회를 얻게 된다)

### 1.5.4 정리
- 비동기 처리 어떻게 ? 자바스크립트 코드는 싱글스레도 비동기 어렵지만, 자바스크립트외에 태스크 큐, 이벤트 루프, 마이크로 태스크 큐, 브라우저/Node.js API등이 적절한 생태계를 이루고 있어 비동기 이벤트 처리가 가능하다.